<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Электрохимия — Виртуальная лаборатория</title>
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2"></script>
  <style>
    .lab-content {
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    .input-group {
      margin: 15px 0;
    }
    label {
      display: inline-block;
      width: 220px;
      font-weight: 500;
    }
    input, select {
      padding: 6px;
      margin-right: 10px;
    }
    canvas {
      margin-top: 20px;
      max-width: 100%;
    }
    #result {
      margin: 20px 0;
      padding: 15px;
      background: #f0f8ff;
      border-left: 4px solid #007bff;
      border-radius: 4px;
    }
    .btn {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <header>
    <div class="container header-content">
      <div class="logo">Виртуальная <span>лаборатория</span></div>
      <nav>
        <ul>
          <li><a href="../index.html">Главная</a></li>
          <li><a href="../theory.html">Теория</a></li>
          <li><a href="titration.html">Титрование</a></li>
          <li><a href="electrochemistry.html" class="active">Электрохимия</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="lab-content">
    <h1 style="text-align:center; color:#0d3b66;">Расчёт ЭДС гальванического элемента</h1>
    <p style="text-align:center; margin-bottom:20px;">
      Введите параметры полуреакций — система рассчитает ЭДС и построит график зависимости от концентрации.
    </p>

    <div class="input-group">
      <label>Анод (окисление):</label>
      <select id="anode">
        <option value="Zn">Zn → Zn²⁺ + 2e⁻</option>
        <option value="Fe">Fe → Fe²⁺ + 2e⁻</option>
      </select>
      <input type="number" id="anode-conc" value="0.1" step="0.01" min="0.001"> М
    </div>

    <div class="input-group">
      <label>Катод (восстановление):</label>
      <select id="cathode">
        <option value="Cu">Cu²⁺ + 2e⁻ → Cu</option>
        <option value="Ag">Ag⁺ + e⁻ → Ag</option>
      </select>
      <input type="number" id="cathode-conc" value="0.01" step="0.01" min="0.001"> М
    </div>

    <button class="btn" onclick="calculate()">Рассчитать ЭДС</button>

    <div id="result"></div>
    <canvas id="emfChart" height="300"></canvas>
  </div>

  <footer>
    <div class="container">
      Кафедра общей химии • ВУЗ • © 2025
    </div>
  </footer>

  <script>
    // Стандартные потенциалы (В)
    const E0 = { 'Zn': -0.76, 'Fe': -0.44, 'Cu': +0.34, 'Ag': +0.80 };
    const electrons = { 'Zn': 2, 'Fe': 2, 'Cu': 2, 'Ag': 1 }; // n для каждой полуреакции

    let emfChart = null;

    function calculate() {
      const anode = document.getElementById('anode').value;
      const cathode = document.getElementById('cathode').value;
      const c_anode = parseFloat(document.getElementById('anode-conc').value);
      const c_cathode = parseFloat(document.getElementById('cathode-conc').value);

      const n_anode = electrons[anode];
      const n_cathode = electrons[cathode];

      // Для корректного расчёта ЭДС обе реакции должны иметь одинаковое n.
      // В учебных целях упростим: будем считать общий n = НОК или просто 2 (для Ag — скорректируем вручную).
      let n = 2;
      let c_ox, c_red;

      // Потенциалы по Нернсту (упрощённая форма при 25°C: E = E0 + (0.059/n)·log([окисл.]/[восст.]))
      let E_anode, E_cathode;

      if (anode === 'Ag') {
        // Ag используется только как катод, но на случай перестановки
        E_anode = E0[anode] + (0.059 / n_anode) * Math.log10(c_anode);
      } else {
        // Для анода: M → Mⁿ⁺ + ne⁻, поэтому [окисл.] = [Mⁿ⁺], [восст.] = 1 (твердый металл)
        E_anode = E0[anode] + (0.059 / n_anode) * Math.log10(c_anode);
      }

      if (cathode === 'Ag') {
        // Ag⁺ + e⁻ → Ag, n = 1
        E_cathode = E0[cathode] + (0.059 / 1) * Math.log10(c_cathode);
        n = 2; // общий n для ЭДС — берём 2 для согласования (условно)
      } else {
        E_cathode = E0[cathode] + (0.059 / n_cathode) * Math.log10(c_cathode);
      }

      const EMF = E_cathode - E_anode;

      document.getElementById('result').innerHTML = `
        <p><b>Анод:</b> ${anode} | ${anode}²⁺ (${c_anode} М) &nbsp;&nbsp; E = ${E_anode.toFixed(3)} В</p>
        <p><b>Катод:</b> ${cathode}²⁺ (${c_cathode} М) | ${cathode} &nbsp;&nbsp; E = ${E_cathode.toFixed(3)} В</p>
        <p><b>ЭДС элемента:</b> <strong>${EMF.toFixed(3)} В</strong></p>
      `;

      plotChart(anode, cathode, c_anode, c_cathode);
    }

    function plotChart(anode, cathode, c_anode, c_cathode) {
      const concentrations = [];
      const emfValues = [];

      // Варьируем концентрацию катода
      for (let c = 0.001; c <= 1.0; c *= 1.4) {
        concentrations.push(c);

        let E_anode = E0[anode] + (0.059 / electrons[anode]) * Math.log10(c_anode);
        let E_cathode;
        if (cathode === 'Ag') {
          E_cathode = E0[cathode] + 0.059 * Math.log10(c);
        } else {
          E_cathode = E0[cathode] + (0.059 / electrons[cathode]) * Math.log10(c);
        }
        emfValues.push((E_cathode - E_anode).toFixed(3));
      }

      const ctx = document.getElementById('emfChart').getContext('2d');
      if (emfChart) emfChart.destroy();

      emfChart = new Chart(ctx, {
        type: 'line',
         {
          labels: concentrations.map(c => c.toExponential(1)),
          datasets: [{
            label: 'ЭДС (В)',
             emfValues,
            borderColor: '#007bff',
            tension: 0.3,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Зависимость ЭДС от концентрации катода'
            }
          },
          scales: {
            x: { title: { display: true, text: 'Концентрация катода (М)' } },
            y: { title: { display: true, text: 'ЭДС (В)' } }
          }
        }
      });
    }

    // Инициализация
    window.onload = calculate;
  </script>
</body>
</html>